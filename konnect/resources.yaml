metadata:
  format_version: "1.0.0"
  type: konnect.team.resources
  region: eu
  team: flight-operations
  description: Flight Operations team resources

resources:
  - type: konnect.control_plane
    name: flight-operations-dev
    description: flight-operations development control plane
    labels:
      env: development

  - type: konnect.control_plane
    name: flight-operations-staging
    description: flight-operations staging control plane
    labels:
      env: staging

  - type: konnect.control_plane
    name: flight-operations-prod
    description: flight-operations production control plane
    labels:
      env: production

  - type: konnect.api
    name: Flights API
    version: v0
    description: KongAir Flights service
    deprecated: false
    labels:
      domain: operations
      team: flight-operations
      criticality: high
    spec_content:
      file: "apis/flights/openapi.yaml"

  - type: konnect.api
    name: Routes API
    version: v0
    description: KongAir Routes service
    labels:
      domain: operations
      team: flight-operations
      criticality: high
    spec_content:
      file: "apis/routes/openapi.yaml"

  - type: konnect.dashboard
    name: kongair-observability
    labels:
      scope: internal
      owner: platform
    definition:
      preset_filters:
        - field: realm
          operator: in
          value:
            - production
      tiles:
        - chart:
            type: chart
            layout:
              position: { col: 0, row: 0 }
              size: { cols: 6, rows: 6 }
            definition:
              chart:
                donut:
                  chart_title: KongAir Requests by API Product
              query:
                api_usage:
                  datasource: api_usage
                  dimensions:
                    - api_product
                  filters:
                    - field: status_code_grouped
                      operator: not_in
                      value:
                        - 5XX
                  granularity: hourly
                  metrics:
                    - kong_latency_p95
                  time_range:
                    relative:
                      type: relative
                      time_range: 7d
                      tz: Etc/UTC

  # - type: konnect.api_publication
  #   api_name: "Flights API"
  #   auto_approve_registrations: true
  #   portal_name: "kongair-api-dev-portal"
  #   visibility: public