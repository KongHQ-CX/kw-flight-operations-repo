metadata:
  format_version: "1.0.0"
  type: konnect.team.resources
  region: eu
  team: flight-operations
  description: Flight Operations team resources

resources:
  - type: konnect.control_plane
    name: flight-operations-dev
    description: flight-operations development control plane
    labels:
      env: development

  - type: konnect.control_plane
    name: flight-operations-staging
    description: flight-operations staging control plane
    labels:
      env: staging

  - type: konnect.control_plane
    name: flight-operations-prod
    description: flight-operations production control plane
    labels:
      env: production

  - type: konnect.api
    name: Flights API
    version: v0
    description: KongAir Flights service
    deprecated: false
    labels:
      domain: operations
      team: flight-operations
      criticality: high
    spec_content:
      file: "apis/flights/openapi.yaml"
  
  - type: konnect.api_document
    api_name: Flights API
    version: v0
    slug: flights-api-documentation
    title: Flights API Documentation
    status: published
    content:
      file: "apis/flights/docs/flights-api.md"

  - type: konnect.api_publication
    api_name: "Flights API"
    version: v0
    auto_approve_registrations: true
    portal_name: KongAir Portal
    visibility: public
    portal_id: 4ccc1394-23aa-4232-9276-aaf419b5810b

  - type: konnect.api
    name: Routes API
    version: v0
    description: KongAir Routes service
    labels:
      domain: operations
      team: flight-operations
      criticality: high
    spec_content:
      file: "apis/routes/openapi.yaml"
  
  - type: konnect.api_document
    api_name: Routes API
    version: v0
    slug: routes-api-documentation
    title: Routes API Documentation
    status: published
    content:
      file: "apis/routes/docs/routes-api.md"

  - type: konnect.api_publication
    api_name: "Routes API"
    version: v0
    auto_approve_registrations: true
    portal_name: KongAir Portal
    visibility: public
    portal_id: 4ccc1394-23aa-4232-9276-aaf419b5810b

  - type: konnect.dashboard
    name: kongair-organization-dashboard
    labels:
      scope: internal
      owner: platform
    definition:    
      tiles:
        - type: "chart"
          layout:
            size:
              cols: 6
              rows: 2
            position:
              col: 0
              row: 0
          definition:
            chart:
              type: "timeseries_line"
              chart_title: "Total traffic over time"
            query:
              metrics:
                - "request_count"
              datasource: "api_usage"
              dimensions:
                - "time"
        - type: "chart"
          layout:
            size:
              cols: 2
              rows: 2
            position:
              col: 0
              row: 2
          definition:
            chart:
              type: "horizontal_bar"
              stacked: true
              chart_title: "Top gateway services by requests"
            query:
              filters:
                - field: "gateway_service"
                  operator: "not_empty"
              metrics:
                - "request_count"
              datasource: "api_usage"
              dimensions:
                - "gateway_service"
        - type: "chart"
          layout:
            size:
              cols: 2
              rows: 2
            position:
              col: 2
              row: 2
          definition:
            chart:
              type: "horizontal_bar"
              stacked: true
              chart_title: "Top routes by requests"
            query:
              filters:
                - field: "route"
                  operator: "not_empty"
              metrics:
                - "request_count"
              datasource: "api_usage"
              dimensions:
                - "route"
        - type: "chart"
          layout:
            size:
              cols: 2
              rows: 2
            position:
              col: 4
              row: 2
          definition:
            chart:
              type: "horizontal_bar"
              stacked: true
              chart_title: "Top consumers by requests"
            query:
              filters:
                - field: "consumer"
                  operator: "not_empty"
              metrics:
                - "request_count"
              datasource: "api_usage"
              dimensions:
                - "consumer"
        - type: "chart"
          layout:
            size:
              cols: 3
              rows: 2
            position:
              col: 0
              row: 4
          definition:
            chart:
              type: "timeseries_line"
              chart_title: "Latency breakdown over time"
            query:
              metrics:
                - "response_latency_p99"
                - "response_latency_p95"
                - "response_latency_p50"
              datasource: "api_usage"
              dimensions:
                - "time"
        - type: "chart"
          layout:
            size:
              cols: 3
              rows: 2
            position:
              col: 3
              row: 4
          definition:
            chart:
              type: "timeseries_line"
              chart_title: "Kong vs upstream latency over time"
            query:
              metrics:
                - "upstream_latency_p99"
                - "kong_latency_p99"
              datasource: "api_usage"
              dimensions:
                - "time"
        - type: "chart"
          layout:
            size:
              cols: 2
              rows: 2
            position:
              col: 0
              row: 6
          definition:
            chart:
              type: "horizontal_bar"
              stacked: true
              chart_title: "Slowest gateway services (average)"
            query:
              filters:
                - field: "gateway_service"
                  operator: "not_empty"
              metrics:
                - "response_latency_average"
              datasource: "api_usage"
              dimensions:
                - "gateway_service"
        - type: "chart"
          layout:
            size:
              cols: 2
              rows: 2
            position:
              col: 2
              row: 6
          definition:
            chart:
              type: "horizontal_bar"
              stacked: true
              chart_title: "Slowest routes (average)"
            query:
              filters:
                - field: "route"
                  operator: "not_empty"
              metrics:
                - "response_latency_average"
              datasource: "api_usage"
              dimensions:
                - "route"
        - type: "chart"
          layout:
            size:
              cols: 2
              rows: 2
            position:
              col: 4
              row: 6
          definition:
            chart:
              type: "horizontal_bar"
              stacked: true
              chart_title: "Slowest consumers (average)"
            query:
              filters:
                - field: "consumer"
                  operator: "not_empty"
              metrics:
                - "response_latency_average"
              datasource: "api_usage"
              dimensions:
                - "consumer"

  # - type: konnect.dashboard
  #   name: kongair-observability
  #   labels:
  #     scope: internal
  #     owner: platform
  #   definition:
  #     tiles:
  #       - chart:
  #           type: chart
  #           layout:
  #             position: { col: 0, row: 0 }
  #             size: { cols: 6, rows: 2 }
  #           definition:
  #             chart:
  #               timeseries_line:
  #                 chart_title: Total traffic over time
  #                 type: timeseries_line
  #             query:
  #               api_usage:
  #                 datasource: api_usage
  #                 dimensions:
  #                   - api_product
  #                 filters:
  #                   - field: status_code_grouped
  #                     operator: not_in
  #                     value: '["5XX"]'
  #                 granularity: hourly
  #                 metrics:
  #                   - kong_latency_p95
  #                 time_range:
  #                   relative:
  #                     type: relative
  #                     time_range: 7d
  #                     tz: Etc/UTC
        


  # - type: konnect.api_publication
  #   api_name: "Flights API"
  #   auto_approve_registrations: true
  #   portal_name: "kongair-api-dev-portal"
  #   visibility: public